

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example 18.3.8 Pertubated Coulomb Potential (PCP) &mdash; Studienprojekt  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="View" href="View.html" />
    <link rel="prev" title="Example 15.2.6: Periodic Functions (modified)" href="Periodic_function.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Studienprojekt
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Grid_points.html">Grid points</a></li>
<li class="toctree-l1"><a class="reference internal" href="Proof_of_principle.html">Proof of principle</a></li>
<li class="toctree-l1"><a class="reference internal" href="Approxim_pi.html">Approximate <span class="math notranslate nohighlight">\(\pi\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Stat_evaluation_for_prob_quad%20.html">Statistical evaluation for error for probabilistic quadratures</a></li>
<li class="toctree-l1"><a class="reference internal" href="Periodic_function.html">Example 15.2.6: Periodic Functions (modified)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example 18.3.8 Pertubated Coulomb Potential (PCP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Results-of-approximations">Results of approximations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Error-estimation">Error estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Algorithm-used-for-calculation-of-data">Algorithm used for calculation of data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="View.html">View</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Studienprojekt</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Example 18.3.8 Pertubated Coulomb Potential (PCP)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/Pertubated_Coulomb_Potential.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Example-18.3.8-Pertubated-Coulomb-Potential-(PCP)">
<h1>Example 18.3.8 Pertubated Coulomb Potential (PCP)<a class="headerlink" href="#Example-18.3.8-Pertubated-Coulomb-Potential-(PCP)" title="Permalink to this headline">¶</a></h1>
<p>We want to implement the example 18.3.8 in the book Tractability of Multivariate Problems Vol 2 for 2 particles The function itself is</p>
<div class="math notranslate nohighlight">
\[f(x_1,x_2,\dots,x_l) = \sum_{1\leq i &lt; j \leq l}\left(\frac{1}{\sqrt{||x_i-x_j||^{2}_{2}+\alpha}}\right)\]</div>
<p>Where x_i, i = 1,2,…,l are three dimensional vectors. We first choose l = 2. Using the results of the example we calculate the function by integrating</p>
<div class="math notranslate nohighlight">
\[\tilde{f}_{\alpha}(z_1, z_2, \dots, z_{3l})=\left(\prod^{6-1}_{j = 1}\left(j+\frac{1}{2}\right)\right) \cdot \frac{(z_1-z_4)^4(z_2-z_5)^4(z_3-z_6)^4}{((z_1-z_4)^2+(z_2-z_5)^2+(z_3-z_6)^2+\alpha)^{13}}\]</div>
<p>over the interval [0,1]⁶. For higher dimension the algorithm gets extremely slow.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">bearcats</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span>
<span class="kn">import</span> <span class="nn">sympy</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">Methodes.Smolyak_one</span> <span class="k">as</span> <span class="nn">Smolyak_one</span>
<span class="kn">import</span> <span class="nn">Methodes.Smolyak_three</span> <span class="k">as</span> <span class="nn">Smolyak_three</span>

</pre></div>
</div>
</div>
<div class="section" id="Results-of-approximations">
<h2>Results of approximations<a class="headerlink" href="#Results-of-approximations" title="Permalink to this headline">¶</a></h2>
<p>We calculated the integral for <span class="math notranslate nohighlight">\(\alpha = 10^{-i}\)</span> for in <span class="math notranslate nohighlight">\(i = 0, \dots, 5\)</span> using different quadratures up to a degree of approximation of up to 23, depending on the runtime of the algorithm. Furthermore it was possible to calculate the integral for <span class="math notranslate nohighlight">\(i = 0\)</span> and <span class="math notranslate nohighlight">\(i=1\)</span> in an acceptable amount of time and with a sufficient accuracy. On this basis we also show a lower bound of the integral for the smaller <span class="math notranslate nohighlight">\(\alpha\)</span> which was estimated on page 393 of the same book. First
we show the results of the approximation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c1"># Settings needed for plotting of results.</span>
<span class="n">option_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Newton-Cotes&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Trapezoidal&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Monte Carlo (non-nested)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Quasi-Monte Carlo&quot;</span><span class="p">]</span>
<span class="n">color_str</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;fuchsia&quot;</span><span class="p">,</span> <span class="s2">&quot;navy&quot;</span><span class="p">,</span> <span class="s2">&quot;limegreen&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">]</span>

<span class="c1"># Load the result the integration of the function calculated by scipy methode nquad</span>
<span class="n">result_scipy_calc_basic</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;integral_Coulomb_alpha_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">k_1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)):</span>
    <span class="c1"># Load single approximation of the PCP different alphas and a wider range of degree of approximation q.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;test_higher_dim_approx_alpha_&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span> <span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">)</span>

    <span class="c1"># Integral could only be  calculated relative exactly by the nquad for the first 2 alphas.</span>
    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">result_scipy_calc</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;integral_Coulomb_alpha_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">)</span>
    <span class="c1"># For alpha &lt; 1 the PCP was approximated using the trapezoidal quadrature and q = 19. Higher approximations</span>
    <span class="c1"># would easily have taken about 5 hours.</span>
    <span class="k">if</span> <span class="n">k_1</span>  <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">single_approx_trap</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;test_higher_dim_approx_one_alpha_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_only_trap.pkl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Trapezoidal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="c1">#  First figure showing the absolut value of the approx in a logarithmical scale</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">k_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">option_list</span><span class="p">)):</span>

        <span class="n">approx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">end_of_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">approx</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">end_of_approx</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">end_of_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">approx</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">k_2</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="n">end_of_approx</span><span class="p">)),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">approx</span><span class="p">[:</span><span class="n">end_of_approx</span><span class="p">]),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color_str</span><span class="p">[</span><span class="n">k_2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="n">end_of_approx</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="mi">17</span><span class="p">)),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">approx</span><span class="p">[</span><span class="n">end_of_approx</span><span class="p">:]),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color_str</span><span class="p">[</span><span class="n">k_2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="mi">13</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">single_approx_trap</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">result_scipy_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmin</span> <span class="o">=</span>  <span class="mf">5.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span> <span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact result&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">result_scipy_calc_basic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])),</span> <span class="n">xmin</span> <span class="o">=</span>  <span class="mf">5.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span> <span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;lower bound of result&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)][:,</span><span class="mi">0</span><span class="p">]))</span>
                     <span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="s2">&quot;bold&quot;</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;result of approximation&quot;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;degree of approximaiton q&quot;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Absolut value of approximation&quot;</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="c1"># Second subplot showing the absolut values.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_list</span><span class="p">)):</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">end_of_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">approx</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">end_of_approx</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">end_of_approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">approx</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">k_2</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="n">end_of_approx</span><span class="p">)),</span> <span class="n">approx</span><span class="p">[:</span><span class="n">end_of_approx</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color_str</span><span class="p">[</span><span class="n">k_2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="n">end_of_approx</span><span class="p">,</span><span class="mi">6</span><span class="o">+</span><span class="mi">17</span><span class="p">)),</span> <span class="n">approx</span><span class="p">[</span><span class="n">end_of_approx</span><span class="p">:],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color_str</span><span class="p">[</span><span class="n">k_2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">k_1</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">6</span><span class="o">+</span><span class="mi">13</span><span class="p">,</span> <span class="n">single_approx_trap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;navy&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span> <span class="nb">abs</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="mf">1.3</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">1.1</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">result_scipy_calc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xmin</span> <span class="o">=</span>  <span class="mf">5.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span> <span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact result&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">result_scipy_calc_basic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mf">0.1</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])),</span> <span class="n">xmin</span> <span class="o">=</span>  <span class="mf">5.5</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span> <span class="mf">6.5</span><span class="o">+</span><span class="mi">17</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;lower bound of result&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span><span class="s2">&quot;bold&quot;</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;result of approximation&quot;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;degree of approximaiton q&quot;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;sci&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Real value of approximation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Approximation for alpha = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>



    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_0.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_1.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_2.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_3.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_4.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_4.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_5_5.png" src="../_images/examples_Pertubated_Coulomb_Potential_5_5.png" />
</div>
</div>
<p>Often the deterministic quadratures the Smolyak algorithm seems approximate the integral for bigger <span class="math notranslate nohighlight">\(\alpha\)</span> in a proper way. Never the less the error bounds are far away from being sufficiently small. In most cases these are bigger than the absolute value of the results. For alpha = 0.01 even the approximation using the trapezoidal algorithm for q = 19 is negative.</p>
<p>Especially the result for the non-deterministic quadratures are varying by several orders of magnitude. Aaprt from this the error estimation for the non-deterministic quadratures are also varying by several magnitudes depending on whether the estimation of the variance includes points near the maximum of the function. In this case it is not possible to say, applying these has advantages compared to especially the trapezoidal quadrature.</p>
<p>It should be noted, that reducing the number of points used by the one dimensional quadratures for q = 1 for this function implies that for q &lt; 4 the result of the approximation is 0.</p>
<p>For the sake of completeness, we show the error estimation of the different algorithms below.</p>
</div>
<div class="section" id="Error-estimation">
<h2>Error estimation<a class="headerlink" href="#Error-estimation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
<span class="n">approx_simple_highdim_fct</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;integral_over_one.pkl&quot;</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.00001</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k_1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha</span><span class="p">)):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;test_higher_dim_approx_alpha_&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span> <span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">k_1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">result_scipy_calc</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;integral_Coulomb_alpha_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">)</span>


    <span class="n">error</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">option_list</span><span class="p">)):</span>
        <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">option_list</span><span class="p">[</span><span class="n">k_2</span><span class="p">]][</span><span class="mi">0</span><span class="p">][:</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k_1</span>  <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">single_approx_trap</span> <span class="o">=</span> <span class="n">bearcats</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;test_higher_dim_approx_one_alpha_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">k_1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_only_trap.pkl&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Trapezoidal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">error</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">]</span>  <span class="o">=</span>  <span class="n">single_approx_trap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">mat</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].pcolor(error,norm=colors.LogNorm(vmin=error[error!=0].min(), vmax=error.max()),
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;brg&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)])

    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_yticks([0.5,1.5,2.5,3.5])
    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_yticklabels([&quot;N.C.&quot;,&quot;T.&quot;, &quot;M.C.&quot;, &quot;Q.M.C.&quot;],fontsize=14, fontweight=&quot;bold&quot;)
    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_xlabel(&quot;degree of approximation q&quot;,fontsize=14, fontweight=&quot;bold&quot;)
    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_xticks([0.5,3.5,6.5,9.5])
    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_xticklabels([6,6+5,6+10,6+15],fontsize=14, fontweight=&quot;bold&quot;)
    <span class="n">ax</span><span class="p">[(</span><span class="n">k_1</span><span class="p">)</span><span class="o">%</span><span class="k">3</span>, int((k_1)/3)].set_title(r&quot;Error for $\alpha$ = &quot;+ str(alpha[k_1]),fontsize=14, fontweight=&quot;bold&quot;)

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Error for approximation of scalar in different dimensions</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_Pertubated_Coulomb_Potential_8_0.png" src="../_images/examples_Pertubated_Coulomb_Potential_8_0.png" />
</div>
</div>
</div>
<div class="section" id="Algorithm-used-for-calculation-of-data">
<h2>Algorithm used for calculation of data<a class="headerlink" href="#Algorithm-used-for-calculation-of-data" title="Permalink to this headline">¶</a></h2>
<p>Below you see the algorithm, with which the integral was approximated.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">import Methodes.Smolyak_one as Smolyak_one</span>
<span class="sd">print(&quot;remove quotes, if you want to generate data.&quot;)</span>
<span class="sd">alpha = [1, 0.1, 0.01, 0.001, 0.0001, 0.00001]</span>
<span class="sd">dim = 6</span>
<span class="sd">option_list = [&quot;Newton-Cotes&quot;,</span>
<span class="sd">               &quot;Trapezoidal&quot;,</span>
<span class="sd">               &quot;Monte Carlo (non-nested)&quot;,</span>
<span class="sd">                &quot;Quasi-Monte Carlo&quot;]</span>

<span class="sd">degree_of_approx = [5, 10, 17, 17, 17]</span>
<span class="sd">approx_result = np.zeros((max(degree_of_approx),len(option_list),2))</span>

<span class="sd">for k_3 in range( len(alpha)):</span>
<span class="sd">    print(&quot;&quot;)</span>
<span class="sd">    print(&quot;alpha = &quot;+ str(alpha[k_3]))</span>
<span class="sd">    print(&quot;&quot;)</span>
<span class="sd">    prefactor = np.sum(np.array(list(range(1,6)))+0.5)</span>
<span class="sd">    function_string = str(prefactor) + &quot; * ((z_1 - z_4) ** 4 * (z_2 - z_5) ** 4  * (z_3 - z_6)**4)/(((z_1 - z_4) ** 2 + (z_2 - z_5) ** 2 + (z_3 - z_6) ** 2 + &quot; + str(alpha[k_3])+ &quot;) ** (13))&quot;</span>
<span class="sd">    variables_string = &quot;(z_1 , z_2 , z_3, z_4 , z_5, z_6)&quot;</span>

<span class="sd">    for k_1  in range(len(option_list)):</span>
<span class="sd">        print(option_list[k_1])</span>
<span class="sd">        for k_2 in range(degree_of_approx[k_1]):</span>
<span class="sd">            approx_result[k_2,k_1,:] = Smolyak_one.controller_smolyak(function_string, variables_string, option_list[k_1], k_2 + 6)[0:2]</span>
<span class="sd">            print(approx_result[k_2,k_1,:])</span>
<span class="sd">    data = {&quot;Newton-Cotes&quot;: [approx_result[:,0,:]],&quot;Trapezoidal&quot;: [approx_result[:,1,:]], &quot;Monte Carlo (non-nested)&quot;: [approx_result[:,2,:]],&quot;Quasi-Monte Carlo&quot;: [approx_result[:,3,:]]}</span>
<span class="sd">    data = bearcats.DataFrame(data=data)</span>
<span class="sd">    bearcats.to_pickle(data,&quot;test_higher_dim_approx_alpha_&quot;+ str(alpha[k_3]) +&quot;.pkl&quot;)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">import scipy</span>
<span class="sd">import numpy as np</span>
<span class="sd">import pandas as bearcats</span>
<span class="sd">alpha = [1, 0.1, 0.01, 0.001, 0.0001, 0.00001]</span>
<span class="sd">dim = 6</span>

<span class="sd">approx_result = np.zeros((max(degree_of_approx),len(option_list),2))</span>

<span class="sd">for k_3 in range(2,len(alpha)):</span>

<span class="sd">    prefactor = np.sum(np.array(list(range(1,6)))+0.5)</span>
<span class="sd">    function_string = str(prefactor) + &quot; * ((z_1 - z_4) ** 4 * (z_2 - z_5) ** 4  * (z_3 - z_6)**4)/(((z_1 - z_4) ** 2 + (z_2 - z_5) ** 2 + (z_3 - z_6) ** 2 + &quot; + str(alpha[k_3])+ &quot;) ** (13))&quot;</span>
<span class="sd">    variables_string = &quot;(z_1 , z_2 , z_3, z_4 , z_5, z_6)&quot;</span>
<span class="sd">    f = Smolyak_one.rewrite_function(function_string, variables_string)[0]</span>
<span class="sd">    borders = [[0,1],[0,1],[0,1],[0,1],[0,1],[0,1]]</span>
<span class="sd">    integral = scipy.integrate.nquad(f, borders, opts = {&quot;epsrel&quot;: 1/alpha[k_3]**2, &quot;epsabs&quot;: 3e4/(alpha[k_3])**2, &quot;limit&quot;: 1 })</span>
<span class="sd">    print(integral)</span>
<span class="sd">    bearcats.to_pickle(integral,&quot;integral_Coulomb_alpha_&quot;+str(alpha[k_3])+&quot;.pkl&quot;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove quotes to approximate function either using the Smolyak algorithm or the scipy.integral package in python.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Remove quotes to approximate function either using the Smolyak algorithm or the scipy.integral package in python.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="View.html" class="btn btn-neutral float-right" title="View" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Periodic_function.html" class="btn btn-neutral float-left" title="Example 15.2.6: Periodic Functions (modified)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Kristoffer Schnieders

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>